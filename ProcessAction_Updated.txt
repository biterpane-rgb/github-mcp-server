BOOL ProcessAction( Ausgabeprozessstatus &Status )
//DFWWS_Belegdruck_Archivierung
  Beleg oBeleg;
  FormularAllSet FormAS;
  Formular oForm;
  STRING sPrintername;
  INT iCopies=1,iBrwRC;
  STRING sEmailParam;
  BOOL bEMail;
  DBSTRINGSET Printers;
  STRING sDefPrinter1="GSD Archiv+",sDefPrinter2="";
  INT iDef;
  STRING sPrintLB = "\\\\SRLDELAS80\\LB-SW";
  STRING sPrintAB = "\\\\SRLDELAS80\\AB-Kopie";
  STRING sPrintLBKopie = "\\\\SRLDELAS80\\LB-Kopie";
  STRING sPrintLS = "\\\\SRLDELAS80\\Lieferschein";

  IF(!::bNoPrintPhysical)
    oBeleg = Status.Prozessobjekt;
    FormAS.SortByIndex("Name");
    sEmailParam = Status.Parameter.GetField("OutputEmail");
    Printers.GetPrinterNamesConnected();
    IF(sEmailParam == "TRUE")
      //IF(DBGetUserName().ToLower() != "gsdadmin")
        bEMail = TRUE;
      //ENDIF
    ELSE
      bEMail = FALSE;
    ENDIF
    IF(bEMail)
      SWITCH(oBeleg.xGSDFaktBelegstufe)
        CASE 1:
          sPrintername = sPrintLB;  //Kasette3
          BREAK;
        CASE 2:
          sPrintername = sPrintLB; //Kasette3
          BREAK;
        CASE 3:
          //Lieferschein/Empfangsschein werden zusammen unten gedruckt
          BREAK;
        CASE 4:
        CASE 5:
          sPrintername = sPrintAB;  //Kasette3 in AB
          iCopies = 2;
          PrintForm(Status.Formular,oBeleg,FALSE,sPrintername,iCopies);
          sPrintername = sPrintLBKopie;  //Kasette3 in LB
          iCopies = 1;
          BREAK;
        DEFAULT:
          sPrintername = sPrintLB;
          BREAK;
      ENDSWITCH
      IF(oBeleg.xGSDFaktBelegstufe != 3)
        PrintForm(Status.Formular,oBeleg,FALSE,sPrintername,iCopies);
      ENDIF
    ENDIF
    //IF(DBGetUserName().ToLower() != "gsdadmin")
      IF(oBeleg.xGSDFaktBelegstufe == 2)
        FormAS.FindKeyStr("Lieferschein");
        FormAS.Get(oForm);
        sPrintername = sPrintLB; //Großraum
        _yit_Fakt::FormDruckName = "Disposchein";
        IF(DBGetUserName().ToLower() == "gsdadmin")
          PrintForm(oForm,oBeleg);
        ELSE
          PrintForm(oForm,oBeleg,FALSE,sPrintername,iCopies);
        ENDIF
        _yit_Fakt::FormDruckName = "Arbeitsschein"; //Großraum
        PrintForm(oForm,oBeleg,FALSE,sPrintername,iCopies);
        _yit_Fakt::FormDruckName = "";
      ELSEIF(oBeleg.xGSDFaktBelegstufe == 3 && oBeleg.Belegart.xGSDFaktBelegtyp == 1)
        FormAS.FindKeyStr("Lieferschein");
        FormAS.Get(oForm);
        sPrintername = sPrintLS; //Kasette 2
        //Lieferschein drucken
        PrintForm(oForm,oBeleg,FALSE,sPrintername,iCopies);
        //Empfangsschein direkt im Anschluss auf gleichem Drucker
        _yit_Fakt::FormDruckName = "Empfangsschein";
        PrintForm(oForm,oBeleg,FALSE,sPrintername,iCopies);
        _yit_Fakt::FormDruckName = "";
        FormAS.FindKeyStr("Beleg allgemein");
        FormAS.Get(oForm);
        sPrintername = sPrintLB;
        _yit_Fakt::FormDruckName = "Rechnungsvorschau"; //Großraum
        PrintForm(oForm,oBeleg,FALSE,sPrintername,iCopies);
        _yit_Fakt::FormDruckName = "";
      ENDIF
    //ELSE
      //MessageBox("Test");
    //ENDIF
    Trace("############## Ende Print");
  ENDIF
RETURN( Status.xGSDFaktProcessAction_VoucherPostArchive() );
